<!doctype html>
<html>
    <head>
        <title>Railroad Diagram</title>

        <link rel="stylesheet" href="railroad.css">

        <script type="module">
            import { Railroad, Parser, Renderer } from './dist/esm/index.js';

            const {
                AlternatingSequence,
                Choice,
                Comment,
                ComplexDiagram,
                Diagram,
                DiagramContainer,
                End,
                Group,
                HorizontalChoice,
                MultipleChoice,
                NonTerminal,
                OneOrMore,
                Optional,
                OptionalSequence,
                Path,
                Sequence,
                Stack,
                Start,
                Terminal,
                ZeroOrMore,
            } = Railroad;

            const parser = new Parser();
            const source = document.getElementById('source');
            const result = document.getElementById('result');

            function initialize() {
                document
                    .getElementById('source')
                    .addEventListener('input', update);
            }

            function update() {
                source.value = source.value.trim();

                const parsed = parser.parse(source.value);
                const renderer = new Renderer(parsed);
                const rules = renderer.ruleNames();

                if (rules.length)
                    result.innerHTML = renderer.render(rules[0]);
            }

            document.addEventListener('DOMContentLoaded', () => {
                initialize();
                update();
            });
        </script>

    </head>
    <body>
        <style>
            body {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 1em;
            }

            section {
                width: 75vw;
            }

            #source {
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                width: 100%;
                min-height: 25vh;
                font: 20px monospace;
                padding: .5em;
            }
        </style>

        <h1>Live Preview</h1>

        <section>
            <picture id="result"></picture>
        </section>

        <h2>Edit the source below to update the diagram above</h2>

        <section>
            <textarea id="source">
Right Hand Side = Terminal
  | Identifier
  | ( "(" , Right Hand Side , ")" ) (* Group *)
  | ( "{" , Right Hand Side , "}" ) (* Repetition *)
  | ( "[" , Right Hand Side , "]" ) (* Optional *)
  | ( "?" , Right Hand Side , "?" ) (* Special *)
  | ( Right Hand Side , "|" , Right Hand Side ) (* Choice *)
  | ( Right Hand Side , "," , Right Hand Side ) (* Sequence *)
  ;
            </textarea>
        </section>

    </body>
</html>