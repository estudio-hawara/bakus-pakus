<!doctype html>
<html>
    <head>
        <title>Railroad Diagram</title>
        <script type="module">
            import { Railroad, Parser, Renderer } from './dist/esm/index.js';

            const {
                AlternatingSequence,
                Choice,
                Comment,
                ComplexDiagram,
                Diagram,
                DiagramContainer,
                End,
                Group,
                HorizontalChoice,
                MultipleChoice,
                NonTerminal,
                OneOrMore,
                Optional,
                OptionalSequence,
                Path,
                Sequence,
                Stack,
                Start,
                Terminal,
                ZeroOrMore,
            } = Railroad;

            const parser = new Parser();
            const source = document.getElementById('source');
            const result = document.getElementById('result');

            function initialize() {
                document
                    .getElementById('source')
                    .addEventListener('input', update);
            }

            function update() {
                const parsed = parser.parse(source.value);
                const renderer = new Renderer(parsed);

                result.innerHTML = renderer.render('rhs');
            }

            document.addEventListener('DOMContentLoaded', () => {
                initialize();
                update();
            });
        </script>
    </head>
    <body>
        <style>
            body {
                font-size: 18px;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 1em;
            }

            section {
                width: 75vw;
            }

            #source {
                -webkit-box-sizing: border-box;
                -moz-box-sizing: border-box;
                box-sizing: border-box;
                width: 100%;
                min-height: 25vh;
                font: italic 16px monospace;
                padding: .5em;
            }
        </style>

        <style>
            svg {
                background-color: hsl(30,20%,95%);
            }

            path {
                stroke-width: 3;
                stroke: black;
                fill: rgba(0,0,0,0);
            }

            text {
                font: bold 14px monospace;
                text-anchor: middle;
                white-space: pre;
            }

            text.diagram-text {
                font-size: 12px;
            }

            text.diagram-arrow {
                font-size: 16px;
            }

            text.label {
                text-anchor: start;
            }

            text.comment {
                font: italic 12px monospace;
            }

            rect {
                stroke-width: 3;
                stroke: black;
                fill: hsl(120,100%,90%);
            }

            rect.group-box {
                stroke: gray;
                stroke-dasharray: 10 5;
                fill: none;
            }

            path.diagram-text {
                stroke-width: 3;
                stroke: black;
                fill: white;
                cursor: help;
            }

            g.diagram-text:hover path.diagram-text {
                fill: #eee;
            }
        </style>

        <h1>Live Preview</h1>

        <section>
            <picture id="result"></picture>
        </section>

        <h2>Edit the source below to update the diagram above</h2>

        <section>
            <textarea id="source">
rhs = terminal
  | identifier
  | ( "(" , rhs , ")" ) (* group *)
  | ( "{" , rhs , "}" ) (* repetition *)
  | ( "[" , rhs , "]" ) (* optional *)
  | ( "?" , rhs , "?" ) (* special *)
  | ( rhs , "|" , rhs ) (* choice *)
  | ( rhs , "," , rhs ) (* sequence *)
  ;
            </textarea>
        </section>

    </body>
</html>